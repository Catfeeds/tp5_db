<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>layui分页</title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    {load file="__STATIC__/layui/layui.all.js"}
    {load file="__STATIC__/layui/css/layui.css"}
    {load file="__STATIC__/js/jquery-3.2.1.min.js"}
</head>
<body>
<table class="layui-hide" id="test" lay-filter="demo"></table>
<script type="text/html" id="barDemo">
    <a class="layui-btn layui-btn-primary layui-btn-xs" lay-event="detail">查看</a>
    <a class="layui-btn layui-btn-xs" lay-event="edit">编辑</a>
    <a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="del">删除</a>
</script>
<script type="text/html" id="switchTpl">
    <!-- 这里的 checked 的状态只是演示 -->
    <input type="checkbox" name="sex" value="{{d.id}}" lay-skin="switch" lay-text="女|男" lay-filter="sexDemo" {{ d.id == 10003 ? 'checked' : '' }}>
</script>

<script type="text/html" id="checkboxTpl">
    <!-- 这里的 checked 的状态只是演示 -->
    <input type="checkbox" name="lock" value="{{d.id}}" title="锁定" lay-filter="lockDemo" {{ d.id == 10006 ? 'checked' : '' }}>
</script>
<script>

    var table = layui.table;
    var form = layui.form;
    var page=1;
    var limit =10;
    table.render({
        elem: '#test'
        // ,url:"{:url('v1.test/ajaxpage')}"//方法1
        ,url:"layui"//方法2 使用路由
        ,cellMinWidth: 80
        ,page: { //支持传入 laypage 组件的所有参数（某些参数除外，如：jump/elem） - 详见文档
            layout: ['prev', 'page', 'next', 'skip','limit', 'count' ] //自定义分页布局
            ,curr: 1 //设定初始在第 5 页
            ,groups: 5 //只显示 1 个连续页码
            // ,first: false //不显示首页
            // ,last: false //不显示尾页

        }
        ,cols: [[
            {type:'numbers'}
            ,{type:'checkbox'}
            ,{field:'uid', width:80, title: 'ID', sort: true}
            ,{field:'username', minWidth:150, title: '用户名'}
            ,{field:'sex', width:80, title: '性别', templet: '#switchTpl', unresize: true}
            ,{field:'ppassword', minWidth:80, title: '支付密码'}
            ,{field:'password', title: '密码', minWidth: 100,event: 'setSign', style:'cursor: pointer'}
            ,{field:'groupid', width:80, title: '积分', sort: true}
            ,{field:'lock', title:'是否锁定', width:110, templet: '#checkboxTpl', unresize: true}
            ,{field:'poperation', width:150, title: '操作', fixed: 'right', toolbar: '#barDemo'}


        ]],
        done: function(res, curr, count){
            //如果是异步请求数据方式，res即为你接口返回的信息。
            //如果是直接赋值的方式，res即为：{data: [], count: 99} data为当前页数据、count为数据总长度
            console.log(res);

            //得到当前页码
            console.log(curr);

            //得到数据总量
            console.log(count);
        }

    });
    //监听工具条
    table.on('tool(demo)', function(obj){
        var data = obj.data;
        if(obj.event === 'detail'){
            layer.msg('ID：'+ data.id + ' 的查看操作');
        } else if(obj.event === 'del'){
            layer.confirm('真的删除行么', function(index){
                obj.del();
                layer.close(index);
            });
        } else if(obj.event === 'edit'){
            layer.alert('编辑行：<br>'+ JSON.stringify(data))
        }else if(obj.event === 'setSign'){
            layer.prompt({
                formType: 2
                ,title: '修改 ID 为 ['+ data.uid +'] 的用户密码'
                ,value: data.password
            }, function(value, index){
                console.log(value);
                layer.close(index);

                //这里一般是发送修改的Ajax请求

                //同步更新表格和缓存对应的值
                obj.update({
                    password: value
                });
            });
        }
    });

//    var laypage = layui.laypage;
//    laypage.render({
//        elem: 'pages',
//        count: {count},
//        limit: {limit},
//        limits: [10, 15, 20],
//        layout: ['count', 'prev', 'page', 'next', 'limit', 'skip'],
//        curr: {page},
//        jump: function (obj, first) {
//            console.log(obj);
//            if (!first) {
//                window.location.href = "{url:('test/pageindex')}?page=" + obj.curr + '&limit=' + obj.limit;
//            }
//        }
//    });
    //监听性别操作
    form.on('switch(sexDemo)', function(obj){
        layer.tips(this.value + ' ' + this.name + '：'+ obj.elem.checked, obj.othis);
    });
    //监听锁定操作
    form.on('checkbox(lockDemo)', function(obj){
        layer.tips(this.value + ' ' + this.name + '：'+ obj.elem.checked, obj.othis);
    });
</script>
</body>
</html>